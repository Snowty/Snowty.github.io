---
layout: post
title: 安全岗面试相关问题--web常见漏洞原理与防御
date: 2018-03-06
tags: Sec 
---

### 怎么又要开始准备面试了
上次准备面试还是15年大三的时候啊，真心是什么都不懂（虽然现在也是...会用wamp建个站就投了安全岗啊233...我真是哪里来的勇气...

今天看到当年投阿里写的在线简历，真是惨不忍睹，估计当时HR看到了以为我是在搞笑吧🤣

下面总结的内容都比较简略，或者直接给出了别人总结的很好的文章供以后查看，因为每个点展开来将都可以写好几篇文章（嗯，为自己偷懒找借口

然后，把CHYbeta大神的[Web-Security-Learning](https://github.com/CHYbeta/Web-Security-Learning)过一遍😳？

### 常见漏洞的原理与防御

1.  XSS：[浅谈XSS—字符编码和浏览器解析原理](https://security.yirendai.com/news/share/26)

+ 常见类型：

    + 反射型XSS：把用户输入的数据“反射”给浏览器，即需要用户点击某链接
    + 存储型XSS：把用户输入的数据存储在服务器
    + DOM Based XSS：也属于反射型XSS，修改页面的DOM节点形成XSS

+ 其他类型的XSS：[跨站的艺术-XSS入门与介绍](http://www.fooying.com/the-art-of-xss-1-introduction/)

    + mXSS:突变型XSS，原本无害，而由于一些特殊原因，如反编码等，导致Payload发生变异，导致的XSS。如：旧版QQ客户端中的链接预览。
    + UXSS:利用浏览器或者浏览器扩展漏洞来制造产生XSS的条件并执行代码的一种攻击类型,可以理解为Bypass同源策略。[通用跨站脚本攻击(UXSS)](http://www.fooying.com/uxss/)
    + Flash XSS:来源于 getURL/navigateToURL（访问跳转）、ExternalInterface.call（调用js函数）
    + UTF-7 XSS:低版本IE中未指定meta编码或指定编码为UTF-7
    + MHTML XSS:低版本IE中
    + CSS XSS:`body {width:expression(alert(1));: red;}`
    + VBScript XSS:`<input type ="button" onClick="VBScript:Document.Write 'hello mr. Fooying' MsgBox 'xss'">`

+ 注入点：
    GET参数、POST参数、UA、Referer...一切可以提交的输入点

+ 危害：[浅谈跨站脚本攻击与防御](https://thief.one/2017/05/31/1/)
    
    + cookie劫持
    + 后台增删改文章
    + 钓鱼，利用xss构造出一个登录框，骗取用户账户密码。
    + xss蠕虫（利用xss漏洞进行传播）
    + 修改网页代码:必须存在存储型xss漏洞，并且将结果返回到页面上
    （javascript加载外部的代码文件可以是任意扩展名（无扩展名也可以））
    + 利用网站重定向
    + 获取用户信息（如浏览器信息，IP地址等）:调用java Applet的接口获取客户端本地IP

+ 防御：

    + 在Cookie中设置`HttpOnly`标识,禁止页面的js访问带有httponly属性的cookie
    + XSS Filter：过滤用户输入的危险字符，设置黑白名单
    + 输出检查：编码和转义，常用编码：html编码、url编码、js编码、16进制、base64等，使得浏览器无法解析执行js代码
    + 针对不同位置的输出，使用不同的处理方式
    + 处理富文本:限制用户能使用的标签，限制为只能使用a、div等安全的标签
    + header中使用content-Sencurity-Policy字段，规定请求js的域名白名单（CSP策略）

+ 绕过：
    + 转换大小写
    + 大小写混写
    + 双引号改单引号
    + 引号改为/
    + 用全角字符
    + 使用javascript伪协议
    + 使用回车、空格等特殊字符
    + 在css的style中使用/**/注释符
    + 使用字符编码
    + 利用事件触发xss
        

+ 常用payload：[tools](https://www.t00ls.net/thread-42640-1-1.html)
        
2.  SQL Injection:

        原理：

            用户输入的数据当做代码执行

        防御：
            
            使用预编译语句，绑定变量

            检查数据类型

            使用安全函数

            最小权限原则

3.  CSRF:

        原理：

            用户登录某账户，浏览器获得cookie

            攻击者诱使用户访问某构造好的恶意CSRF页面

        防御：
            
            验证码

            Referer Check（HTTPS跳转到HTTP不会发送Referer）

            Anti CSRF Token

4.  SSRF（Server-Side Request Forgery）:服务器端请求伪造（这个漏洞我还真的没有测试过...
    
        参考：http://uknowsec.cn/posts/notes/SSRF%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%88%A9%E7%94%A8%E4%B8%8E%E5%AD%A6%E4%B9%A0.html

        原理：
        
            由攻击者构造的攻击链接传给服务端执行造成的漏洞，一般用来在外网探测或攻击内网服务

        可利用的伪协议：

            对curl函数的滥用，dict file ftp ftps gopher http https imap imaps pop3 pop3s rtsp smb smbs smtp smtps telnet tftp 

        防御：

            过滤返回信息

            限制请求端口

            内网IP黑名单
    

5.  XXE

        参考：https://thief.one/2017/06/20/1/


